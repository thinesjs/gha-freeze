#!/bin/sh

set -e

echo "ğŸ” Running pre-commit checks..."

echo "ğŸ“ Checking formatting..."
unformatted=$(gofmt -l . 2>&1 | grep -v "vendor/" || true)
if [ -n "$unformatted" ]; then
    echo "âŒ The following files are not formatted:"
    echo "$unformatted"
    echo ""
    echo "Run: gofmt -w ."
    exit 1
fi
echo "âœ… All files are formatted"

echo "ğŸ”§ Running go vet..."
if ! go vet ./...; then
    echo "âŒ go vet failed"
    exit 1
fi
echo "âœ… go vet passed"

if command -v golangci-lint > /dev/null 2>&1; then
    echo "ğŸ” Running golangci-lint..."
    if ! golangci-lint run --timeout=5m; then
        echo "âŒ golangci-lint failed"
        exit 1
    fi
    echo "âœ… golangci-lint passed"
else
    echo "âš ï¸  golangci-lint not installed, skipping"
    echo "Install with: brew install golangci-lint (macOS) or go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest"
fi

echo "âœ… All pre-commit checks passed!"
